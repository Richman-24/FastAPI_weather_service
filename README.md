# FastAPI_weather_service

## Описание проекта: 
Этот проект представляет собой асинхронный HTTP-сервер, который предоставляет REST API для получения информации о погоде с использованием Open-Meteo API.
Сервер позволяет пользователям запрашивать данные о погоде по координатам или названиям городов, а также отслеживать прогнозы погоды для выбранных городов.

## Стэк проекта:
- fastapi + uvicorn
- SQLAlchemy + sqlite3 (асинхонный)
- httpx + Open-Meteo API
- pytest, postman

## Установка и запуск:
- развернуть венв, установить зависимости
```bash
python3 -m venv .venv
pip install -r requirements.txt
``` 
- запустить проект из корневого каталога
```bash
python script.py
```

## Методы API:
### Пользователи:
#### Регистрация нового пользователя:

Запрос: POST "http://127.0.0.1:8000/users/"
Описание: Создает нового пользователя.
Параметры запроса: username (строка) — имя пользователя.

Ответ (success): 
```json
{
  "id": 1
}
```

#### Получение пользователя
Запрос: GET http://127.0.0.1:8000/user/1
Описание: Получает информацию о пользователе по id.
Параметры запроса: id (int) — id пользователя.

Ответ (success):
```json
{
    "username": "test1"
}
```

### Города:
#### Добавление города
Запрос: POST 127.0.0.1:8000/cities/
Описание: Добавляет город в список пользователя для отслеживания погоды.
Параметры запроса: 
- user_id (int) — ID пользователя,
- name (str) - Название города (хранится в .lower())
- latitude (float) - координаты точки
- longitude (float) - координаты точки

Ответ (success):
```json
{
    "OK": "Город city_1 успешно добавлен"
}
```

#### Получение списка всех отслеживаемых городов: 
Запрос: GET 127.0.0.1:8000/cities/
Описание: Выводит все добавленные в базу города.

Ответ (success):
```json
[
    "city_1",
    "city_2"
]
```

#### Получение списка городов пользователя: 
Запрос: GET http://127.0.0.1:8000/cities?user_id=1
Описание: Выводит все добавленные в базу города.
Параметры запроса: user_id (целое число) — ID пользователя.

Ответ (success):
```json
[
    "city_1",
    "city_2"
]
```

### Погода:
#### Получение текущей погоды
Запрос: GET "http://127.0.0.1:8000/weather/current/"

Описание: Получает текущую погоду по координатам.
Параметры запроса:

- latitude (число) — широта.
- longitude (число) — долгота.

Ответ (success):
```json
{
  "current_weather": {
    "temperature": 5.0,
    "windspeed": 3.5,
    "pressure": 1015.0
  }
}
```

#### Получение прогноза погоды для города на определенное время
Запрос: GET "http://127.0.0.1:8000/weather/
Описание: Получает прогноз погоды для указанного города на определенный час.
Параметры запроса:

- city_name (строка) — название города.
- time (целое число) — час (от 0 до 23).
- params (строка) — список параметров через запятую (один из: "temperature", "presure", "windspeed", "humidity").

Ответ: 
```json
{
    "temperature": 0.4,
    "presure": 993.4,
    "windspeed": 11.0,
    "humidity": 96.0
}
```

### Примечания
- API будет доступно по адресу: http://127.0.0.1:8000.
- Для получения данных о погоде используется API Open-Meteo.
- Автообновление прогноза погоды запускается каждые 15 минут.

### Планы развития
- Может напишу тесты на pytest
- Может добавлю валидаторы (username, cityname и т.д.)

### Автор работы
[Дреев Максим](https://github.com/richman-24) <br>
[telegram: @richman24](https://t.me/richman_24)